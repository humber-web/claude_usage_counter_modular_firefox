<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude Usage Counter</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #f8fafc;
      width: 320px;
      color: #333;
      font-size: 13px;
    }

    .container {
      background: white;
      border: 1px solid #e2e8f0;
    }

    .header {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      color: white;
      padding: 12px 16px;
      text-align: center;
    }

    .header h1 {
      font-size: 16px;
      font-weight: 600;
      margin: 0;
    }

    .content {
      padding: 12px;
    }

    .section {
      margin-bottom: 12px;
    }

    .section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      font-weight: 500;
      color: #374151;
      min-width: 60px;
      font-size: 12px;
    }

    select, input[type="number"] {
      flex: 1;
      padding: 6px 8px;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      font-size: 12px;
      transition: border-color 0.2s ease;
    }

    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px;
      background: #f9fafb;
      border-radius: 6px;
      margin-bottom: 6px;
    }

    .checkbox-group:last-child {
      margin-bottom: 0;
    }

    input[type="checkbox"] {
      width: 14px;
      height: 14px;
      accent-color: #4f46e5;
    }

    .stats-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
      margin-bottom: 8px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
    }

    .stat-label {
      color: #64748b;
      font-size: 11px;
    }

    .stat-value {
      font-weight: 600;
      color: #1e293b;
      font-size: 12px;
    }

    .stat-highlight {
      background: white;
      padding: 8px;
      border-radius: 6px;
      border-left: 3px solid #4f46e5;
    }

    .muted {
      color: #64748b;
      font-size: 10px;
      text-align: center;
      margin-top: 6px;
      font-style: italic;
    }

    details {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      overflow: hidden;
    }

    details summary {
      padding: 10px;
      cursor: pointer;
      user-select: none;
      background: #f1f5f9;
      font-weight: 500;
      color: #374151;
      border-bottom: 1px solid #e2e8f0;
      font-size: 12px;
    }

    details[open] summary {
      border-bottom: 1px solid #e2e8f0;
    }

    details .content {
      padding: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .grid label {
      display: block;
      font-size: 10px;
      color: #64748b;
      margin-bottom: 2px;
      min-width: auto;
    }

    .grid input {
      width: 100%;
      margin: 0;
    }

    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }

    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 12px;
    }

    #reset {
      background: #f3f4f6;
      color: #374151;
    }

    #reset:hover {
      background: #e5e7eb;
    }

    #save {
      background: #4f46e5;
      color: white;
    }

    #save:hover {
      background: #4338ca;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Claude Usage Counter</h1>
    </div>
    
    <div class="content">
      <div class="section">
        <div class="form-group">
          <label>Plan:</label>
          <select id="plan">
            <option value="free">Free</option>
            <option value="pro" selected>Pro</option>
            <option value="max5x">Max (5×)</option>
            <option value="max20x">Max (20×)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Estimator:</label>
          <select id="est">
            <option value="chars4">~1 token / 4 chars</option>
            <option value="words13">~1.3 tokens / word</option>
          </select>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="justCount">
          <label for="justCount">Apenas contar mensagens</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="countAtt">
          <label for="countAtt">Contar anexos (ficheiros/imagens)</label>
        </div>
      </div>

      <div class="section">
        <div class="stats-card">
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-label">Messages (5h):</span>
              <span class="stat-value" id="msgs">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Estimated tokens (text):</span>
              <span class="stat-value" id="toks">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Draft est. tokens:</span>
              <span class="stat-value" id="draft">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Files:</span>
              <span class="stat-value"><span id="fileCount">0</span> • est. tokens <span id="fileTokens">0</span></span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Images:</span>
              <span class="stat-value"><span id="imgCount">0</span> • est. tokens <span id="imgTokens">0</span></span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Last msg:</span>
              <span class="stat-value">text <span id="lastText">0</span> • files <span id="lastFile">0</span> • imgs <span id="lastImg">0</span></span>
            </div>
          </div>
          
          <div class="stat-highlight">
            <div class="stat-item">
              <span class="stat-label">Remaining (plan):</span>
              <span class="stat-value" id="left">—</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Reset in:</span>
              <span class="stat-value" id="countdown">--:--</span>
            </div>
          </div>
          
          <div class="muted">Auto-resets every ~5 hours.</div>
        </div>
      </div>

      <div class="section">
        <details>
          <summary>Settings de anexos</summary>
          <div class="content">
            <div class="grid">
              <div>
                <label>bytes/token (texto)</label>
                <input id="bpt_text" type="number" min="1" value="4">
              </div>
              <div>
                <label>bytes/token (pdf)</label>
                <input id="bpt_pdf" type="number" min="1" value="12">
              </div>
              <div>
                <label>bytes/token (docx/xlsx/pptx)</label>
                <input id="bpt_docx" type="number" min="1" value="10">
              </div>
              <div>
                <label>bytes/token (outros)</label>
                <input id="bpt_other" type="number" min="1" value="12">
              </div>
            </div>
            
            <div class="form-group">
              <label>Image mode:</label>
              <select id="imgMode">
                <option value="byResolution">By resolution</option>
                <option value="flat">Flat per image</option>
              </select>
            </div>
            
            <div class="grid" id="imgByRes">
              <div>
                <label>Small (&lt;1MP) tokens</label>
                <input id="imgSmall" type="number" min="0" value="300">
              </div>
              <div>
                <label>Medium (1–2MP) tokens</label>
                <input id="imgMed" type="number" min="0" value="600">
              </div>
              <div>
                <label>Large (2–6MP) tokens</label>
                <input id="imgLarge" type="number" min="0" value="1200">
              </div>
              <div>
                <label>Huge (&gt;6MP) tokens</label>
                <input id="imgHuge" type="number" min="0" value="2400">
              </div>
            </div>
            
            <div class="form-group" id="imgFlatRow" style="display:none;">
              <label>Flat tokens per image:</label>
              <input id="imgFlat" type="number" min="0" value="600">
            </div>
          </div>
        </details>
      </div>

      <div class="button-group">
        <button id="reset">Reset</button>
        <button id="save">Save</button>
      </div>
    </div>
  </div>

  <script src="ui.js"></script>
  <script src="api.js"></script>
  <script src="controller.js"></script>
  <script src="popup.js"></script>
</body>
</html>
